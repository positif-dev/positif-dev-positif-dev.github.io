<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title></title>
</head>
<body>
  <div id="content"></div>
  <script type="text/javascript">
    (async () => {
      'use strict'

      const $  = (root, el) => root.querySelector(el)
      const $$ = (root, el) => root.querySelectorAll(el)
      const RSS_URL = 'https://anchor.fm/s/2a147024/podcast/rss'

      let content = ''

      await fetch(RSS_URL, {cache: 'force-cache'})
        .then(resp => resp.text())
        .then(str => str.replace(/<\!\[CDATA\[|\]\]>/g, ''))
        .then(str => str.replace("itunes:image", "itunes_image"))
        .then(str => str.replace("itunes:image", "itunes_image"))
        .then(str => new DOMParser().parseFromString(str, "text/xml"))
        .then(data => $$(data, 'item'))
        .then(items => {
          items.forEach(item => {
            const title = $(item, 'title').innerHTML
            const description = $(item, 'description').innerHTML
            const image = $(item, 'itunes_image').getAttribute('href')
            const link = $(item, 'link').innerHTML
            const mp3 = $(item, 'enclosure').getAttribute('url')
            const date = new Date($(item, 'pubDate').innerHTML)
            const formattedDate = date.toLocaleDateString('en-US', {
              year: 'numeric',
              month: 'long',
              day: 'numeric'
            })

            content += `<h1>${title}</h1>
            <a href="${link}" target="_blank">anchor link</a>
            ${description}
            <div>${formattedDate}</div>
            <img src="${image}" width="160">
            <audio src="${mp3}" controls>
              Your browser does not support the audio element.
              </audio>`
          })
        })

      $(document, '#content').innerHTML = content
    })()
  </script>
</body>
</html>